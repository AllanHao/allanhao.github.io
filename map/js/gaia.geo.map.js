!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=ol},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n(2),n(3),n(4),n(5);var o=function(){function t(e,n){function r(){a=!0,console.log("onConnected"),l.subscribe("/geolocation"),o("info").innerText="连接成功。",i=0}function o(t){return document.getElementById(t)}!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var a=!1,i=0,l=new Paho.MQTT.Client("59.110.63.140",8083,"/mqtt","_clientId");l.connect({onSuccess:r}),l.onConnectionLost=function(t){0!==t.errorCode&&(console.log("onConnectionLost:"+t.errorMessage),console.log("连接已断开"),o("info").innerText="连接已断开。",i<3&&(i++,l.connect({onSuccess:r})))},l.onMessageArrived=function(t){console.log("收到消息:"+t.payloadString)};var s=new ol.View({center:[0,0],zoom:10,minZoom:1,maxZoom:18}),u=new ol.Map({target:e,controls:ol.control.defaults({attributionOptions:{collapsible:!1},rotate:!1}),view:s});u.on("click",function(t){console.log(t.coordinate)});var c=void 0;switch(n){case 1:c=new ol.layer.Tile({title:"osm",source:new ol.source.OSM}),u.addLayer(c);break;case 2:c=new ol.layer.Tile({source:new ol.source.XYZ({tileUrlFunction:function(t){var e=t[0],n=t[1],r=t[2];return r=-r-1,"http://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x="+n+"&y="+r+"&z="+e}})}),u.addLayer(c);break;case 3:c=new ol.layer.Tile({title:"tianLayer1",source:new ol.source.Tianditu({url:"http://t2.tianditu.com/vec_c/wmts",matrixSet:"c",layer:"vec",projection:"EPSG:4326"})});var f=new ol.layer.Tile({title:"tianLayer2",source:new ol.source.Tianditu({url:" http://t2.tianditu.com/cva_c/wmts",matrixSet:"c",layer:"cva",projection:"EPSG:4326"})});u.addLayer(c),u.addLayer(f);break;case 4:c=new ol.layer.Tile({title:"amap",source:new ol.source.BingMaps({key:"As1HiMj1PvLPlqc_gtM7AqZfBL8ZL3VrjaS3zIb22Uvb9WKhuJObROC-qUpa81U5",imagerySet:"Road"})}),u.addLayer(c);break;default:c=new ol.layer.Tile({title:"amap",source:new ol.source.OSM}),u.addLayer(c)}var p=new ol.Geolocation({tracking:!0,projection:s.getProjection()}),d=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(77,167,99,0.8)",width:5,lineCap:"round"})}),h=new ol.Feature({geometry:new ol.geom.LineString([])}),g=new ol.layer.Vector({source:new ol.source.Vector({features:[h]}),style:d});u.addLayer(g);var y=new ol.Feature({speed:"",heading:""});y.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})),p.on("change",function(){o("accuracy").innerText=p.getAccuracy().toFixed(2)+" [m]";var t=57.3*(p.getHeading()?p.getHeading():0),e="";t>=0&&t<=15||t>345?e="北":t>15&&t<=75?e="东北":t>75&&t<=105?e="东":t>105&&t<=165?e="东南":t>165&&t<=195?e="南":t>195&&t<=255?e="西南":t>255&&t<=285?e="西":t>285&&t<=345&&(e="西北"),o("heading").innerText=e;var n=p.getSpeed()?p.getSpeed():0,r=n<=5?n.toFixed(2)+" [m/s]":(3.6*n).toFixed(2)+" [km/h]";o("speed").innerText=r}),p.on("error",function(t){var e=document.getElementById("info");e.innerHTML=t.message,e.style.display=""});var m=new ol.Feature;p.on("change:position",function(){var t=p.getPosition();if(2===n){t=ol.proj.transform(t,"EPSG:3857","EPSG:4326");var e=eviltransform.wgs2gcj(t[1],t[0]);t=ol.proj.transform([e.lng,e.lat],"EPSG:4326","EPSG:3857")}u.getView().setCenter(t),y.setGeometry(t?new ol.geom.Point(t):null),y.set("speed",p.getSpeed()+" [m/s]"),y.set("heading",p.getHeading()+" [rad]"),h.getGeometry().appendCoordinate(t);var r=57.3*(p.getHeading()?p.getHeading():0)+" [°]",i=p.getSpeed()?p.getSpeed():0,s=i<=5?i.toFixed(2)+" [m/s]":(3.6*i).toFixed(2)+" [km/h]";if(a){var c={clientId:"_clientId",coordinate:t,speed:s,heading:r};l.send("/geolocation",JSON.stringify(c)),o("info").innerText=function(){var t=new Date,e=t.getMonth()+1,n=t.getDate();return e>=1&&e<=9&&(e="0"+e),n>=0&&n<=9&&(n="0"+n),t.getFullYear()+"-"+e+"-"+n+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}()+" 上报位置成功。"}}),new ol.layer.Vector({map:u,source:new ol.source.Vector({features:[m,y]})})}return r(t,[{key:"guid",value:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}]),t}();e.default=o,gaia.GeoMap=o},function(t,e,n){"use strict";var r=window.gaia=window.gaia||{};t.exports=r,r.layer=r.layer||{},r.interaction=r.interaction||{},r.events=r.events||{},Array.prototype.addFunction=function(t){var e=!0;if(this.length>0)for(var n=0;n<this.length;n++){this[n].toString().replace(t,"$1")===t.toString().replace(t,"$1")&&(e=!1)}e&&this.push(t)},Array.prototype.statistic=function(){if(this.length<=0)return null;var t,e,n=0,r=0,o=[];for(t=0;t<this.length;t+=1)n+=parseFloat(this[t]);r=n/this.length;var a=parseFloat(this[0]),i=parseFloat(this[0]);for(e=0;e<this.length;e+=1)parseFloat(this[e])<a&&(a=parseFloat(this[e])),parseFloat(this[e])>i&&(i=parseFloat(this[e])),o.push(Math.pow(parseFloat(this[e])-r,2));return{min:a,max:i,avg:r,std:Math.sqrt(o.reduce(function(t,e){return t+e})/this.length)}},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t},r.Constant={type:1,featureInvalidInterval:60,analysisUrl:"https://dataapi.smartmall.gaiais.com",analysisLastDays:15,analysisStartTime:"8:00:00",gis2wifiFloor:{},getTimeNowStr:function(){var t=new Date;return 1===r.Constant.type&&(t.setFullYear(2018),t.setMonth(4),t.setDate(15)),t.format("yyyy-MM-dd hh:mm:ss")},getDateNowStr:function(){var t=new Date;return 1===r.Constant.type&&(t.setFullYear(2018),t.setMonth(4),t.setDate(15)),t.format("yyyy-MM-dd")},getDateNow:function(){var t=new Date;return 1===r.Constant.type&&(t.setFullYear(2018),t.setMonth(4),t.setDate(15)),t},getYestodayDateStr:function(){var t=new Date;return 1===r.Constant.type&&(t.setFullYear(2018),t.setMonth(4),t.setDate(15)),t.setDate(t.getDate()-1),t.format("yyyy-MM-dd")},getYestodayTimeStr:function(){var t=new Date;return 1===r.Constant.type&&(t.setFullYear(2018),t.setMonth(4),t.setDate(15)),t.setDate(t.getDate()-1),t.format("yyyy-MM-dd hh:mm:ss")},getDatetimeStr:function(t){if(t&&t.getFullYear)return t.format("yyyy-MM-dd hh:mm:ss")},getDateStr:function(t){if(t&&t.getFullYear)return t.format("yyyy-MM-dd")}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),o=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);void 0!==(t=t||{}).attributions?option.attributions:r.default.source.AMap.ATTRIBUTION;var n;n="sat"==t.mapType?"http://webst0{1-4}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}":"http://webrd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}";var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{crossOrigin:"anonymous",cacheSize:t.cacheSize,projection:r.default.proj.get("EPSG:3857"),url:n,wrapX:void 0===t.wrapX||t.wrapX}));return o.ATTRIBUTION=new r.default.Attribution({html:'&copy; <a class="ol-attribution-amap" href="http://ditu.amap.com/">高德地图</a>'}),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default.source.XYZ),e}();e.default=o,r.default.source.AMap=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t||{},r=n.attributions||new o.default.Attribution({html:"Map Data <a href='http://www.tianditu.com' target='_blank'><img style='background-color:transparent;bottom:2px;opacity:1;' src='http://api.tianditu.com/img/map/logo.png' width='53px' height='22px' opacity='0'></a> with <span>© <a href='http://iclient.supermapol.com' target='_blank'>SuperMap iClient</a></span>"});return n.url||n.urls||(n.url="http://t{0-7}.tianditu.com/img_w/wmts"),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{version:n.version||"1.0.0",format:n.format||"tiles",dimensions:n.dimensions||{},layer:n.layer||"img",matrixSet:n.matrixSet||"w",tileGrid:n.tileGrid||o.default.source.Tianditu.getTileGrid(n.projection||"EPSG:3857"),style:n.style||"default",attributions:r,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,opaque:n.opaque||!0,maxZoom:n.maxZoom||19,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileLoadFunction:n.tileLoadFunction,url:n.url,urls:n.urls,projection:n.projection||"EPSG:3857",wrapX:n.wrapX}))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default.source.WMTS),r(e,null,[{key:"getTileGrid",value:function(t){return"EPSG:4326"===t||"EPSG:4490"===t?o.default.source.Tianditu.default4326TileGrid():o.default.source.Tianditu.default3857TileGrid()}},{key:"default4326TileGrid",value:function(){for(var t=[],e=[],n=0;n<18;n++)t.push(.703125/Math.pow(2,n)),e.push(n+1);return new o.default.tilegrid.WMTS({extent:[-180,-90,180,90],resolutions:t,origin:[-180,90],matrixIds:e,minZoom:1})}},{key:"default3857TileGrid",value:function(){for(var t=[],e=[],n=0;n<18;n++)t.push(78271.51696402031/Math.pow(2,n)),e.push(n+1);return new o.default.tilegrid.WMTS({extent:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],resolutions:t,matrixIds:e,origin:[-20037508.3427892,20037508.3427892],minZoom:1})}}]),e}();e.default=a,o.default.source.Tianditu=a},function(t,e,n){"use strict";(function(t){function e(t,e){return e<72.004||e>137.8347||(t<.8293||t>55.8271)}function n(t,e){var n=.006693421622965943,r=function(t,e){var n=t*e,r=Math.sqrt(Math.abs(t)),o=t*Math.PI,a=e*Math.PI,i=20*Math.sin(6*o)+20*Math.sin(2*o),l=i,s=i;return l+=20*Math.sin(a)+40*Math.sin(a/3),s+=20*Math.sin(o)+40*Math.sin(o/3),l+=160*Math.sin(a/12)+320*Math.sin(a/30),s+=150*Math.sin(o/12)+300*Math.sin(o/30),l*=2/3,s*=2/3,l+=2*t-100+3*e+.2*e*e+.1*n+.2*r,s+=300+t+2*e+.1*t*t+.1*n+.1*r,{lat:l,lng:s}}(e-105,t-35),o=t/180*Math.PI,a=Math.sin(o);a=1-n*a*a;var i=Math.sqrt(a);return r.lat=180*r.lat/(s*(1-n)/(a*i)*Math.PI),r.lng=180*r.lng/(s/i*Math.cos(o)*Math.PI),r}function r(t,r){if(e(t,r))return{lat:t,lng:r};var o=n(t,r);return{lat:t+o.lat,lng:r+o.lng}}function o(t,r){if(e(t,r))return{lat:t,lng:r};var o=n(t,r);return{lat:t-o.lat,lng:r-o.lng}}function a(t,n){if(e(t,n))return{lat:t,lng:n};var r=n,o=t,a=Math.sqrt(r*r+o*o)+2e-5*Math.sin(o*Math.PI),i=Math.atan2(o,r)+3e-6*Math.cos(r*Math.PI),l=a*Math.cos(i)+.0065;return{lat:a*Math.sin(i)+.006,lng:l}}function i(t,n){if(e(t,n))return{lat:t,lng:n};var r=n-.0065,o=t-.006,a=Math.sqrt(r*r+o*o)-2e-5*Math.sin(o*Math.PI),i=Math.atan2(o,r)-3e-6*Math.cos(r*Math.PI),l=a*Math.cos(i);return{lat:a*Math.sin(i),lng:l}}var l;"object"===("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)&&l?l=t.exports:"undefined"!=typeof window&&(l=window.eviltransform={});var s=6378137;l.wgs2gcj=r,l.gcj2wgs=o,l.gcj2wgs_exact=function(t,e){for(var n=t,o=e,a=n,i=o,l=0;l<30;l++){a=n,i=o;var s=r(n,o);if(n-=t-s.lat,o-=e-s.lng,Math.max(Math.abs(a-n),Math.abs(i-o))<1e-6)break}return{lat:n,lng:o}},l.distance=function(t,e,n,r){var o=Math.PI/180,a=t*o,i=n*o,l=Math.cos(a)*Math.cos(i)*Math.cos((e-r)*o)+Math.sin(a)*Math.sin(i);return l>1&&(l=1),l<-1&&(l=-1),Math.acos(l)*s},l.gcj2bd=a,l.bd2gcj=i,l.wgs2bd=function(t,e){var n=r(t,e);return a(n.lat,n.lng)},l.bd2wgs=function(t,e){var n=i(t,e);return o(n.lat,n.lng)}}).call(e,n(6)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}}]);
//# sourceMappingURL=gaia.geo.map.js.map